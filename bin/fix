#!/usr/bin/env bash

root=$(npm explore lint-my-app -- pwd >/dev/null 2>&1 || echo .)
stylelintConfig=$(node $root/addConfig stylelint)

code=0

sort-package-json
code=$(($code + $?))

eslint --fix --ignore-path .gitignore --color --ignore-pattern '!.*.js' --report-unused-disable-directives $(node $root/addConfig eslint) .
code=$(($code + $?))

stylelint --fix --ignore-path .gitignore --color $stylelintConfig "**/*.css"
code=$(($code + $?))
stylelint --fix --ignore-path .gitignore --color $stylelintConfig --report-needless-disables "**/*.css"
code=$(($code + $?))

stylelint --syntax=scss --fix --ignore-path .gitignore $stylelintConfig "**/*.scss"
code=$(($code + $?))
stylelint --syntax=scss --fix --ignore-path .gitignore $stylelintConfig --report-needless-disables "**/*.scss"
code=$(($code + $?))

git ls-files | grep "\.json$" | grep -v package | xargs -I{} fixjson --write "$(pwd)/{}"
code=$(($code + $?))

git ls-files | grep "\.\(png\|jpeg\|jpg\|gif\|svg\)$" | xargs -I{} imagemin-lint-staged "$(pwd)/{}"
code=$(($code + $?))

exit $code
